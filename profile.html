<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Vardhan's Wear</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <link rel="manifest" href="/manifest.json">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        #message-box {
            display: none;
            position: fixed;
            top: 5rem;
            right: 1.5rem;
            background-color: white;
            padding: 1rem;
            border-radius: 0.375rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 100;
            border-left-width: 4px;
        }
        #pincode-spinner { display: none; }
        .order-card-link {
            display: block;
            transition: all 0.2s ease-in-out;
        }
        .order-card-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        /* Tabbed Interface Styles */
        .tab-button {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: #4b5563; /* gray-600 */
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        .tab-button:hover {
            color: #111827; /* gray-900 */
        }
        .tab-button.active {
            color: #db2777; /* pink-600 */
            border-bottom-color: #db2777;
        }
        .tab-content {
            display: none; /* Hidden by default */
        }
        .tab-content.active {
            display: block; /* Shown when active */
        }
        /* Address card accent */
        .address-card:has(input:checked) {
            border-color: #db2777; /* pink-600 */
            box-shadow: 0 0 0 2px #db2777;
        }
    </style>
</head>
<body class="bg-gray-50">

    
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-gray-800">Vardhan Wears</a>
            
            <div class="flex items-center space-x-4">
                <a href="cart.html" class="p-2 text-gray-600 hover:text-gray-900">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="sr-only">Cart</span>
                </a>
                <a href="index.html" class="hidden md:block text-gray-600 hover:text-gray-900 font-medium">Home</a>
                
                <div class="relative hidden md:block">
                    <button onclick="toggleDesktopMenu()" id="desktop-menu-btn" class="text-gray-800 focus:outline-none text-xl p-2 rounded-md hover:bg-gray-100">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div id="desktop-menu-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-50 border border-gray-200">
                        </div>
                </div>

                <div class="md:hidden">
                    <button id="menu-btn" class="text-gray-800 focus:outline-none">
                        <i class="fas fa-bars fa-lg"></i>
                    </button>
                </div>
            </div>

        </nav>
        <div id="mobile-nav-links" class="md:hidden hidden bg-white">
             </div>
    </header>

    
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 mt-8 pb-16">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Welcome, <span id="user-name-display">...</span></h1>
        
        <div class="bg-gradient-to-b from-white to-pink-50 rounded-lg shadow-lg border border-pink-100">
            <div class="border-b border-pink-200">
                <nav class="flex -mb-px overflow-x-auto" aria-label="Tabs">
                    <button class="tab-button active flex-shrink-0" onclick="showProfileTab('profile')">
                        <i class="fas fa-user-edit mr-2 hidden md:inline"></i>My Profile
                    </button>
                    <button class="tab-button flex-shrink-0" onclick="showProfileTab('addresses')">
                        <i class="fas fa-map-marker-alt mr-2 hidden md:inline"></i>My Addresses
                    </button>
                    <button class="tab-button flex-shrink-0" onclick="showProfileTab('orders')">
                        <i class="fas fa-receipt mr-2 hidden md:inline"></i>My Orders
                    </button>
                </nav>
            </div>
            
            <div>
                <div id="profile-tab-content" class="tab-content active p-4 md:p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <section class="lg:col-span-1 flex flex-col items-center p-6 border rounded-lg bg-white shadow-sm">
                            <h2 class="text-xl font-semibold text-gray-900 mb-4">Profile Picture</h2>
                            <div class="relative w-32 h-32 rounded-full overflow-hidden border-4 border-gray-200 flex items-center justify-center">
                                <img id="profile-picture-preview" src="https://placehold.co/128x128/e2e8f0/64748b?text=+" alt="Profile Picture" class="w-full h-full object-cover">
                                <label for="profile-picture-upload" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 text-white text-sm opacity-0 hover:opacity-100 cursor-pointer transition-opacity duration-300">
                                    <i class="fas fa-camera text-xl"></i>
                                </label>
                                <input type="file" id="profile-picture-upload" class="hidden" accept="image/*">
                            </div>
                            <button id="upload-picture-btn" class="mt-4 bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-sm" disabled>
                                Upload Picture
                            </button>
                        </section>

                        <section class="lg:col-span-2 p-6 border rounded-lg bg-white shadow-sm">
                            <h2 class="text-xl font-semibold text-gray-900 mb-4">Your Credentials</h2>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Name</label>
                                    <div class="mt-1 flex items-center">
                                        <input type="text" id="user-name-input" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 sm:text-sm p-2 bg-gray-100" readonly>
                                        <button id="edit-name-btn" class="ml-2 px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm">Edit</button>
                                        <button id="update-name-btn" class="ml-2 px-3 py-1 bg-pink-600 text-white rounded-md hover:bg-pink-700 text-sm hidden">Update</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Email</label>
                                    <p id="user-email" class="mt-1 text-gray-900 p-2 border border-gray-200 rounded-md bg-gray-100">...</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Role</label>
                                    <p id="user-role" class="mt-1 text-gray-900 p-2 border border-gray-200 rounded-md bg-gray-100">...</p>
                                </div>
                            </div>
                        </section>

                        <section class="lg:col-span-3 p-6 border rounded-lg bg-white shadow-sm">
                            <h2 class="text-xl font-semibold text-gray-900 mb-4">Change Password</h2>
                            <form id="change-password-form" class="space-y-4 max-w-md mx-auto">
                                <div>
                                    <label for="current-password" class="block text-sm font-medium text-gray-700">Current Password</label>
                                    <input type="password" id="current-password" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 sm:text-sm p-2" required>
                                </div>
                                <div>
                                    <label for="new-password" class="block text-sm font-medium text-gray-700">New Password</label>
                                    <input type="password" id="new-password" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 sm:text-sm p-2" required>
                                </div>
                                <div>
                                    <label for="confirm-new-password" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                                    <input type="password" id="confirm-new-password" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 sm:text-sm p-2" required>
                                </div>
                                <button type="submit" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                                    Update Password
                                </button>
                            </form>
                        </section>
                    </div>
                </div>

                <div id="addresses-tab-content" class="tab-content p-4 md:p-6">
                    <section id="manage-addresses">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                            <h2 class="text-2xl font-bold text-gray-900">Manage Saved Addresses</h2>
                            <button id="show-address-form-btn" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 w-full sm:w-auto">
                                <i class="fas fa-plus mr-2"></i>Add New Address
                            </button>
                        </div>
                        <div id="address-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <p class="text-gray-500">Loading saved addresses...</p>
                        </div>
                    </section>
                </div>

                <div id="orders-tab-content" class="tab-content p-4 md:p-6">
                    <section id="order-history">
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">My Order History</h2>
                        
                        <div class="flex flex-col md:flex-row gap-4 mb-6">
                            <div class="flex-1">
                                <label for="primary-filter" class="block text-sm font-medium text-gray-700">Show Orders</label>
                                <select id="primary-filter" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500">
                                    <option value="ongoing" selected>Ongoing</option>
                                    <option value="delivered">Delivered</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div id="date-filter-container" class="flex-1 hidden">
                                <label for="date-filter" class="block text-sm font-medium text-gray-700">Filter by Date</label>
                                <select id="date-filter" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500">
                                    <option value="all">All Time</option>
                                    <option value="30days">Last 30 Days</option>
                                    <option value="3months">Last 3 Months</option>
                                    <option value="6months">Last 6 Months</option>
                                </select>
                            </div>
                        </div>

                        <div id="order-list" class="space-y-6">
                            <p class="text-gray-500">Loading your order history...</p>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <div id="address-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 id="address-modal-title" class="text-2xl font-bold">Add New Address</h2>
                <button id="close-address-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <form id="address-form" class="space-y-4">
                <input type="hidden" id="address-id"> <div>
                    <label for="addr-fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="addr-fullName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="addr-countryCode" class="block text-sm font-medium text-gray-700">Country Code</label>
                        <input type="text" id="addr-countryCode" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-100" value="+91" readonly>
                    </div>
                    <div class="md:col-span-2">
                        <label for="addr-phone" class="block text-sm font-medium text-gray-700">Phone Number (10-digit)</label>
                        <input type="tel" id="addr-phone" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required pattern="[0-9]{10}" title="Please enter a 10-digit phone number">
                    </div>
                </div>
                <div>
                    <label for="addr-address" class="block text-sm font-medium text-gray-700">Street Address</label>
                    <input type="text" id="addr-address" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="addr-postalCode" class="block text-sm font-medium text-gray-700">Postal Code</label>
                        <div class="relative">
                            <input type="text" id="addr-postalCode" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required maxlength="6">
                            <i id="pincode-spinner" class="fas fa-spinner fa-spin absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label for="addr-city" class="block text-sm font-medium text-gray-700">City</label>
                        <input type="text" id="addr-city" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="addr-state" class="block text-sm font-medium text-gray-700">State</label>
                        <input type="text" id="addr-state" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                    </div>
                    <div>
                        <label for="addr-country" class="block text-sm font-medium text-gray-700">Country</label>
                        <input type="text" id="addr-country" value="India" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-100" readonly>
                    </div>
                </div>
                <div class="pt-4">
                    <button type="submit" id="save-address-btn" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                        Save Address
                    </button>
                </div>
            </form>
        </div>
    </div>


    <div id="message-box">
        <p id="message-text" class="font-medium"></p>
    </div>

    <script>
        // =================== DEPLOYMENT FIX: Add API_URL ===================
        const API_URL = 'https://vardhan-wears-api.onrender.com';
        // ===================================================================

        // Cloudinary (Unchanged)
        const CLOUDINARY_CLOUD_NAME = 'dbhtu0kzg'; 
        const CLOUDINARY_UPLOAD_PRESET = 'vardhan_uploads'; 

        // --- Menu Toggles (Unchanged) ---
        const menuBtn = document.getElementById('menu-btn');
        const mobileNavLinks = document.getElementById('mobile-nav-links'); 
        menuBtn.addEventListener('click', () => {
            mobileNavLinks.classList.toggle('hidden');
        });
        function toggleDesktopMenu() {
            document.getElementById('desktop-menu-dropdown').classList.toggle('hidden');
        }
        window.onclick = function(event) {
            if (!event.target.matches('#desktop-menu-btn') && !event.target.closest('#desktop-menu-btn')) {
                const dropdown = document.getElementById('desktop-menu-dropdown');
                if (dropdown && !dropdown.classList.contains('hidden')) {
                    dropdown.classList.add('hidden');
                }
            }
        }

        // --- Auth Logic (Modified) ---
        async function checkAuth() {
            const token = localStorage.getItem('token');
            const desktopDropdown = document.getElementById('desktop-menu-dropdown');
            let desktopLinks = '';
            let mobileLinks = '';
            
            desktopLinks = `
                <a href="index.html#collection" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Products</a>
                <a href="index.html#about" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">About</a>
                <a href="index.html#contact" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Contact</a>
                <hr class="my-1 border-gray-100">
            `;
            
            mobileLinks = `
                <a href="index.html#home" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100">Home</a>
                <a href="index.html#collection" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100">Products</a>
                <a href="index.html#about" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100">About</a>
                <a href="index.html#contact" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100">Contact</a>
                <hr class="my-1 border-gray-100">
            `;


            if (!token) {
                window.location.href = 'login.html'; 
                return;
            } 
            
            try {
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const res = await fetch(`${API_URL}/api/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                // ===================================================================
                if (!res.ok) {
                    localStorage.removeItem('token');
                    window.location.href = 'login.html'; 
                    return;
                }
                const user = await res.json();
                
                // Logout Button is correctly included here
                desktopLinks += `
                    ${user.isAdmin ? '<a href="admin.html" class="block px-4 py-2 text-sm text-yellow-600 font-bold hover:bg-gray-100">Admin Panel</a>' : ''}
                    <button onclick="logout()" class="block px-4 py-2 text-sm text-red-600 font-bold hover:bg-red-50 w-full text-left">Logout</button>
                `;
                mobileLinks += `
                    ${user.isAdmin ? '<a href="admin.html" class="block py-2 px-6 text-sm text-yellow-600 font-bold hover:bg-gray-100">Admin Panel</a>' : ''}
                    <button onclick="logout()" class="block py-2 px-6 text-sm text-red-600 font-bold hover:bg-red-50 w-full text-left">Logout</button>
                `;

                renderProfile(user); 
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('token');
                window.location.href = 'login.html'; 
            }
            
            desktopDropdown.innerHTML = desktopLinks;
            mobileNavLinks.innerHTML = mobileLinks;
        }

        function logout() {
            localStorage.removeItem('token'); 
            localStorage.removeItem('vardhansCart'); // Also clear guest cart on logout
            window.location.href = 'index.html'; 
        }

        // --- Profile Page Logic ---
        let currentUser = null; 
        let selectedFile = null; 
        let allUserOrders = []; 

        // Tab Switching Function
        function showProfileTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab-content`).classList.add('active');
            document.querySelector(`.tab-button[onclick="showProfileTab('${tabName}')"]`).classList.add('active');
        }


        document.addEventListener('DOMContentLoaded', () => {
            // PWA SERVICE WORKER 
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration);
                    })
                    .catch((error) => {
                        console.error('Service Worker registration failed:', error);
                    });
            }

            checkAuth();
            setupEventListeners();
            loadAndStoreOrders(); 
            loadSavedAddresses(); 
        });

        function renderProfile(user) {
            currentUser = user; 
            document.getElementById('user-name-display').textContent = user.name;
            document.getElementById('user-name-input').value = user.name;
            document.getElementById('user-email').textContent = user.email;
            document.getElementById('user-role').textContent = user.isAdmin ? 'Admin' : 'User';

            const profilePicPreview = document.getElementById('profile-picture-preview');
            if (user.profilePicture) {
                profilePicPreview.src = user.profilePicture;
            } else {
                profilePicPreview.src = `https://placehold.co/128x128/e2e8f0/64748b?text=${user.name.charAt(0).toUpperCase()}`;
            }
        }

        function setupEventListeners() {
            // Profile Picture Upload
            const profilePictureUpload = document.getElementById('profile-picture-upload');
            const profilePicturePreview = document.getElementById('profile-picture-preview');
            const uploadPictureBtn = document.getElementById('upload-picture-btn');

            profilePictureUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    selectedFile = file; 
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        profilePicturePreview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                    uploadPictureBtn.disabled = false; 
                } else {
                    selectedFile = null;
                    uploadPictureBtn.disabled = true;
                    if (currentUser && currentUser.profilePicture) {
                        profilePicturePreview.src = currentUser.profilePicture;
                    } else if (currentUser) {
                        profilePicturePreview.src = `https://placehold.co/128x128/e2e8f0/64748b?text=${currentUser.name.charAt(0).toUpperCase()}`;
                    }
                }
            });
            uploadPictureBtn.addEventListener('click', uploadProfilePicture);

            // Edit Name
            const editNameBtn = document.getElementById('edit-name-btn');
            const updateNameBtn = document.getElementById('update-name-btn');
            const userNameInput = document.getElementById('user-name-input');
            editNameBtn.addEventListener('click', () => {
                userNameInput.readOnly = false;
                userNameInput.classList.remove('bg-gray-100');
                userNameInput.focus();
                editNameBtn.classList.add('hidden');
                updateNameBtn.classList.remove('hidden');
            });
            updateNameBtn.addEventListener('click', updateUserName);

            // Change Password
            const changePasswordForm = document.getElementById('change-password-form');
            changePasswordForm.addEventListener('submit', changePassword);

            // Address Modal Listeners
            document.getElementById('show-address-form-btn').addEventListener('click', () => openAddressModal());
            document.getElementById('close-address-modal-btn').addEventListener('click', () => document.getElementById('address-modal').classList.add('hidden'));
            document.getElementById('address-form').addEventListener('submit', handleAddressFormSubmit);
            document.getElementById('addr-postalCode').addEventListener('input', handlePincode);

            // Order Filter Listeners
            document.getElementById('primary-filter').addEventListener('change', filterAndRenderOrders);
            document.getElementById('date-filter').addEventListener('change', filterAndRenderOrders);
        }

        // Profile Picture Upload Logic (Unchanged)
        async function uploadProfilePicture() {
            if (!selectedFile) { showMessage('Please select an image.', 'error'); return; }
            if (CLOUDINARY_CLOUD_NAME === "") { showMessage('Cloudinary is not configured.', 'error'); return; }

            const uploadButton = document.getElementById('upload-picture-btn');
            uploadButton.disabled = true;
            uploadButton.textContent = 'Uploading...';
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

            try {
                const cloudinaryResponse = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                    method: 'POST',
                    body: formData
                });
                if (!cloudinaryResponse.ok) throw new Error('Cloudinary upload failed.');
                const cloudinaryData = await cloudinaryResponse.json();
                const imageUrl = cloudinaryData.secure_url;

                const token = localStorage.getItem('token');
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const backendResponse = await fetch(`${API_URL}/api/auth/profile-picture`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ profilePicture: imageUrl })
                });
                // ===================================================================
                if (!backendResponse.ok) {
                    const errorData = await backendResponse.json();
                    throw new Error(errorData.message || 'Failed to update profile picture.');
                }
                
                const updatedUser = await backendResponse.json();
                renderProfile(updatedUser); 
                showMessage('Profile picture updated!', 'success');
                selectedFile = null;
                document.getElementById('profile-picture-upload').value = null;
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                showMessage(error.message, 'error');
            } finally {
                uploadButton.disabled = true;
                uploadButton.textContent = 'Upload Picture';
            }
        }

        // Update Name Logic (Unchanged)
        async function updateUserName() {
            const userNameInput = document.getElementById('user-name-input');
            const updateNameBtn = document.getElementById('update-name-btn');
            const editNameBtn = document.getElementById('edit-name-btn');
            const newName = userNameInput.value.trim();

            if (newName === currentUser.name) {
                userNameInput.readOnly = true;
                userNameInput.classList.add('bg-gray-100');
                editNameBtn.classList.remove('hidden');
                updateNameBtn.classList.add('hidden');
                return;
            }
            if (!newName) { showMessage('Name cannot be empty.', 'error'); return; }
            updateNameBtn.disabled = true;
            updateNameBtn.textContent = 'Updating...';

            try {
                const token = localStorage.getItem('token');
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const response = await fetch(`${API_URL}/api/auth/name`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ name: newName })
                });
                // ===================================================================
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to update name.');
                }
                const updatedUser = await response.json();
                renderProfile(updatedUser); 
                showMessage('Name updated successfully!', 'success');
            } catch (error) {
                console.error('Error updating name:', error);
                showMessage(error.message, 'error');
                userNameInput.value = currentUser.name; 
            } finally {
                userNameInput.readOnly = true;
                userNameInput.classList.add('bg-gray-100');
                editNameBtn.classList.remove('hidden');
                updateNameBtn.classList.add('hidden');
                updateNameBtn.disabled = false;
                updateNameBtn.textContent = 'Update';
            }
        }

        // Change Password Logic (Unchanged)
        async function changePassword(event) {
            event.preventDefault();
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmNewPassword = document.getElementById('confirm-new-password').value;
            if (!currentPassword || !newPassword || !confirmNewPassword) { showMessage('Please fill in all password fields.', 'error'); return; }
            if (newPassword.length < 6) { showMessage('New password must be at least 6 characters long.', 'error'); return; }
            if (newPassword !== confirmNewPassword) { showMessage('New passwords do not match.', 'error'); return; }
            if (currentPassword === newPassword) { showMessage('New password cannot be the same as current password.', 'info'); return; }

            try {
                const token = localStorage.getItem('token');
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const response = await fetch(`${API_URL}/api/auth/change-password`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ currentPassword, newPassword })
                });
                // ===================================================================
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to change password.');
                }
                showMessage('Password updated successfully!', 'success');
                document.getElementById('change-password-form').reset();
            } catch (error) {
                console.error('Error changing password:', error);
                showMessage(error.message, 'error');
            }
        }

        // --- Order History Logic (API Path Fixes) ---
        async function loadAndStoreOrders() {
            const orderListContainer = document.getElementById('order-list');
            const token = localStorage.getItem('token');
            if (!token) { orderListContainer.innerHTML = '<p class="text-red-500">Could not find auth token.</p>'; return; }

            try {
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const res = await fetch(`${API_URL}/api/orders/myorders`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                // ===================================================================
                if (!res.ok) throw new Error('Could not load your orders.');
                
                allUserOrders = await res.json();
                
                allUserOrders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                populateYearFilters();
                filterAndRenderOrders(); 

            } catch (error) {
                console.error('Error loading orders:', error);
                orderListContainer.innerHTML = '<p class="text-red-500">There was an error loading your order history.</p>';
            }
        }

        function populateYearFilters() {
            const dateFilterSelect = document.getElementById('date-filter');
            const currentYear = new Date().getFullYear();
            const relevantYears = [currentYear, currentYear - 1, currentYear - 2];
            
            const orderYears = [...new Set(allUserOrders.map(order => new Date(order.createdAt).getFullYear()))];
            
            const yearsToShow = orderYears
                .filter(year => relevantYears.includes(year))
                .sort((a, b) => b - a); 

            Array.from(dateFilterSelect.options).forEach(option => {
                if (!['all', '30days', '3months', '6months'].includes(option.value)) {
                    option.remove();
                }
            });

            yearsToShow.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                dateFilterSelect.appendChild(option);
            });
        }

        function filterAndRenderOrders() {
            const primaryFilter = document.getElementById('primary-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            const dateFilterContainer = document.getElementById('date-filter-container');

            let filteredOrders = [];

            if (primaryFilter === 'ongoing') {
                filteredOrders = allUserOrders.filter(order => !order.isDelivered && !order.isCancelled);
                dateFilterContainer.classList.add('hidden'); 
            } else {
                if (primaryFilter === 'delivered') {
                    filteredOrders = allUserOrders.filter(order => order.isDelivered);
                } else if (primaryFilter === 'cancelled') {
                    filteredOrders = allUserOrders.filter(order => order.isCancelled);
                }
                dateFilterContainer.classList.remove('hidden'); 

                if (dateFilter === 'all') {
                    // No change
                } else if (dateFilter === '30days') {
                    const thirtyDaysAgo = new Date(new Date().setDate(new Date().getDate() - 30));
                    filteredOrders = filteredOrders.filter(order => new Date(order.createdAt) >= thirtyDaysAgo);
                } else if (dateFilter === '3months') {
                    const ninetyDaysAgo = new Date(new Date().setMonth(new Date().getMonth() - 3));
                    filteredOrders = filteredOrders.filter(order => new Date(order.createdAt) >= ninetyDaysAgo);
                } else if (dateFilter === '6months') { 
                    const sixMonthsAgo = new Date(new Date().setMonth(new Date().getMonth() - 6));
                    filteredOrders = filteredOrders.filter(order => new Date(order.createdAt) >= sixMonthsAgo);
                } else {
                    filteredOrders = filteredOrders.filter(order => new Date(order.createdAt).getFullYear().toString() === dateFilter);
                }
            }
            
            renderOrderList(filteredOrders);
        }

        function renderOrderList(orders) {
            const orderListContainer = document.getElementById('order-list');
            orderListContainer.innerHTML = ''; 

            if (orders.length === 0) {
                orderListContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No orders found for this filter.</p>';
                return;
            }

            orders.forEach(order => {
                const orderCard = document.createElement('a');
                orderCard.href = `order-details.html?id=${order._id}`;
                orderCard.className = 'order-card-link bg-white border border-gray-200 rounded-lg p-4 block shadow-sm hover:shadow-md transition-shadow'; 

                let paidStatus, deliveryStatus, actionsHtml;

                if (order.isCancelled) {
                    paidStatus = `<span class="font-medium text-gray-500">---</span>`;
                    deliveryStatus = `<span class="font-medium text-gray-500">Cancelled</span>`;
                    actionsHtml = '';
                } else if (!order.isPaid) {
                    paidStatus = `<span class="font-medium text-red-600">Payment Pending</span>`;
                    deliveryStatus = `<span class="font-medium text-yellow-600">Awaiting Payment</span>`;
                    actionsHtml = `
                        <button class="text-sm font-medium bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 z-10 relative" onclick="handleCancel(event, '${order._id}')">
                            Cancel Order
                        </button>
                        <button class="text-sm font-medium bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 z-10 relative" onclick="handleRepay(event, '${order._id}')">
                            Repay Now
                        </button>
                    `;
                } else if (order.isPaid && !order.isDelivered) {
                    paidStatus = `<span class="font-medium text-green-600">Paid</span>`;
                    
                    const orderDate = new Date(order.createdAt);
                    const estimatedDeliveryDate = new Date(new Date(order.createdAt).setDate(orderDate.getDate() + 7));
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    estimatedDeliveryDate.setHours(0, 0, 0, 0);

                    const tomorrow = new Date();
                    tomorrow.setDate(today.getDate() + 1);
                    tomorrow.setHours(0,0,0,0);

                    if (today.getTime() === estimatedDeliveryDate.getTime()) {
                        deliveryStatus = `<span class="font-medium text-blue-600">Arriving Today</span>`;
                    } else if (tomorrow.getTime() === estimatedDeliveryDate.getTime()) {
                        deliveryStatus = `<span class="font-medium text-green-600">Arriving Tomorrow</span>`;
                    } else if (today > estimatedDeliveryDate) {
                        deliveryStatus = `<span class="font-medium text-red-600">Delayed</span>`;
                    } else {
                        const dateString = estimatedDeliveryDate.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
                        deliveryStatus = `<span class="font-medium text-green-600">Arriving by ${dateString}</span>`;
                    }
                    actionsHtml = '';
                } else { // Paid and Delivered
                    paidStatus = `<span class="font-medium text-green-600">Paid</span>`;
                    deliveryStatus = `<span class="font-medium text-blue-600">Delivered on ${new Date(order.deliveredAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}</span>`;
                    actionsHtml = '';
                }

                let itemsHtml = '<div class="flex space-x-2 mt-2">';
                order.orderItems.slice(0, 5).forEach(item => {
                    itemsHtml += `<img src="${item.image}" alt="${item.name}" class="w-12 h-12 rounded-md object-cover" title="${item.name} (Qty: ${item.quantity})">`;
                });
                if (order.orderItems.length > 5) {
                    itemsHtml += `<div class="w-12 h-12 rounded-md bg-gray-100 flex items-center justify-center text-xs font-medium text-gray-600">+${order.orderItems.length - 5}</div>`;
                }
                itemsHtml += '</div>';

                orderCard.innerHTML = `
                    <div class="flex flex-wrap justify-between items-center mb-2 gap-2">
                        <div>
                            <h3 class="text-sm font-semibold text-gray-800">Order ID:</h3>
                            <span class="text-xs font-mono text-gray-600">${order._id}</span>
                        </div>
                        <span class="text-sm text-gray-600">${new Date(order.createdAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}</span>
                    </div>
                    <div class="flex flex-wrap justify-between items-center text-sm gap-4">
                        <div>
                            <p>Status: ${deliveryStatus}</p>
                            <p>Payment: ${paidStatus}</p>
                        </div>
                        <p class="text-lg font-bold text-pink-600">â‚¹${order.totalPrice.toFixed(2)}</p>
                    </div>
                    <div class="mt-4">
                        <h4 class="text-sm font-medium text-gray-700">Items:</h4>
                        ${itemsHtml}
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200 flex justify-between items-center">
                        <a href="index.html#contact" class="text-sm font-medium text-pink-600 hover:underline z-10 relative" onclick="(e) => e.stopPropagation()">
                            <i class="fas fa-question-circle mr-1"></i> Help
                        </a>
                        <div class="space-x-3">
                            ${actionsHtml}
                        </div>
                    </div>
                `;
                orderListContainer.appendChild(orderCard);
            });
        }

        // --- Address Management Logic (API Path Fixes) ---
        async function loadSavedAddresses() {
            const addressList = document.getElementById('address-list');
            const showAddressBtn = document.getElementById('show-address-form-btn');
            const token = localStorage.getItem('token');
            if (!token) { return; }
            try {
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const res = await fetch(`${API_URL}/api/auth/addresses`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                // ===================================================================
                if (!res.ok) throw new Error('Could not load addresses.');
                const addresses = await res.json();
                renderAddressList(addresses);
            } catch (error) {
                console.error('Error loading addresses:', error);
                addressList.innerHTML = '<p class="text-red-500">Could not load saved addresses.</p>';
            }
        }

        function renderAddressList(addresses) {
            const addressList = document.getElementById('address-list');
            const showAddressBtn = document.getElementById('show-address-form-btn');
            addressList.innerHTML = ''; 
            if (addresses.length === 0) {
                addressList.innerHTML = '<p class="text-gray-500 col-span-1 md:col-span-2 lg:col-span-3">You have no saved addresses.</p>';
            }
            addresses.forEach(addr => {
                const addressCard = document.createElement('div');
                addressCard.className = 'p-4 bg-white border border-gray-200 rounded-lg shadow-sm';
                addressCard.innerHTML = `
                    <p class="font-bold text-gray-800">${addr.fullName}</p>
                    <p class="text-sm text-gray-600">${addr.address}</p>
                    <p class="text-sm text-gray-600">${addr.city}, ${addr.state} - ${addr.postalCode}</p>
                    <p class="text-sm text-gray-600">${addr.countryCode} ${addr.phone}</p>
                    <div class="mt-3 space-x-2">
                        <button class="text-sm text-pink-600 hover:underline" onclick="openAddressModal('${addr._id}')">Edit</button>
                        <button class="text-sm text-red-600 hover:underline" onclick="handleDeleteAddress('${addr._id}')">Delete</button>
                    </div>
                `;
                addressList.appendChild(addressCard);
            });
            if (addresses.length >= 3) {
                showAddressBtn.disabled = true;
                showAddressBtn.classList.add('opacity-50', 'cursor-not-allowed');
                showAddressBtn.title = 'You can only save a maximum of 3 addresses.';
            } else {
                showAddressBtn.disabled = false;
                showAddressBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                showAddressBtn.title = '';
            }
        }

        async function openAddressModal(addressId = null) {
            const modal = document.getElementById('address-modal');
            const form = document.getElementById('address-form');
            const title = document.getElementById('address-modal-title');
            const addressIdInput = document.getElementById('address-id');
            form.reset(); 
            addressIdInput.value = ''; 
            if (addressId) {
                title.textContent = 'Edit Address';
                try {
                    const token = localStorage.getItem('token');
                    // =================== DEPLOYMENT FIX: Use API_URL ===================
                    const res = await fetch(`${API_URL}/api/auth/addresses`, {
                         headers: { 'Authorization': `Bearer ${token}` }
                    });
                    // ===================================================================
                    const addresses = await res.json();
                    const addressToEdit = addresses.find(addr => addr._id === addressId);
                    if (!addressToEdit) throw new Error('Address not found');
                    addressIdInput.value = addressToEdit._id;
                    document.getElementById('addr-fullName').value = addressToEdit.fullName;
                    document.getElementById('addr-countryCode').value = addressToEdit.countryCode;
                    document.getElementById('addr-phone').value = addressToEdit.phone;
                    document.getElementById('addr-address').value = addressToEdit.address;
                    document.getElementById('addr-postalCode').value = addressToEdit.postalCode;
                    document.getElementById('addr-city').value = addressToEdit.city;
                    document.getElementById('addr-state').value = addressToEdit.state;
                    document.getElementById('addr-country').value = addressToEdit.country;
                } catch (error) {
                    showMessage(error.message, 'error');
                    return;
                }
            } else {
                title.textContent = 'Add New Address';
            }
            modal.classList.remove('hidden');
        }

        async function handleAddressFormSubmit(event) {
            event.preventDefault();
            const saveBtn = document.getElementById('save-address-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';
            const addressId = document.getElementById('address-id').value;
            const isEditMode = !!addressId;
            const addressData = {
                fullName: document.getElementById('addr-fullName').value,
                countryCode: document.getElementById('addr-countryCode').value,
                phone: document.getElementById('addr-phone').value,
                address: document.getElementById('addr-address').value,
                postalCode: document.getElementById('addr-postalCode').value,
                city: document.getElementById('addr-city').value,
                state: document.getElementById('addr-state').value,
                country: document.getElementById('addr-country').value,
            };
            // =================== DEPLOYMENT FIX: Use API_URL ===================
            const url = isEditMode 
                ? `${API_URL}/api/auth/addresses/${addressId}` 
                : `${API_URL}/api/auth/addresses`;
            // ===================================================================
            const method = isEditMode ? 'PUT' : 'POST';
            try {
                const token = localStorage.getItem('token');
                const res = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify(addressData)
                });
                const data = await res.json();
                if (!res.ok) {
                    let errorMsg = data.message;
                    if (data.message && data.message.includes('ValidationError')) {
                         errorMsg = "Validation Error: Please check all fields. Phone must be 10 digits.";
                    }
                    throw new Error(errorMsg || 'Failed to save address.');
                }
                showMessage(`Address ${isEditMode ? 'updated' : 'saved'} successfully!`, 'success');
                document.getElementById('address-modal').classList.add('hidden');
                renderAddressList(data); 
            } catch (error) {
                console.error('Error saving address:', error);
                showMessage(error.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Address';
            }
        }

        async function handleDeleteAddress(addressId) {
            if (!confirm('Are you sure you want to delete this address?')) {
                return;
            }
            try {
                const token = localStorage.getItem('token');
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const res = await fetch(`${API_URL}/api/auth/addresses/${addressId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                // ===================================================================
                const data = await res.json();
                if (!res.ok) {
                    throw new Error(data.message || 'Failed to delete address.');
                }
                showMessage('Address deleted successfully!', 'success');
                renderAddressList(data); 
            } catch (error) {
                console.error('Error deleting address:', error);
                showMessage(error.message, 'error');
            }
        }

        // Pincode Auto-fill (Unchanged)
        let pincodeTimer;
        function handlePincode(event) {
            const pincode = event.target.value;
            clearTimeout(pincodeTimer);
            if (pincode.length === 6) {
                const spinner = document.getElementById('pincode-spinner');
                spinner.style.display = 'inline-block';
                pincodeTimer = setTimeout(() => {
                    fetchAddressFromPincode(pincode, spinner);
                }, 500);
            }
        }
        async function fetchAddressFromPincode(pincode, spinner) {
            try {
                const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
                if (!response.ok) throw new Error('Invalid Pincode');
                const data = await response.json();
                if (data[0].Status === 'Success' && data[0].PostOffice.length > 0) {
                    const postOffice = data[0].PostOffice[0];
                    document.getElementById('addr-city').value = postOffice.District;
                    document.getElementById('addr-state').value = postOffice.State;
                    document.getElementById('addr-country').value = postOffice.Country;
                } else {
                    throw new Error('Pincode not found.');
                }
            } catch (error) {
                showMessage(error.message, 'error');
                document.getElementById('addr-city').value = '';
                document.getElementById('addr-state').value = '';
            } finally {
                if(spinner) spinner.style.display = 'none';
            }
        }

        // Handle Order Repay (API Path Fix)
        async function handleRepay(event, orderId) {
            event.preventDefault(); 
            event.stopPropagation(); 

            const repayButton = event.target;
            repayButton.disabled = true;
            repayButton.textContent = 'Processing...';
            try {
                const token = localStorage.getItem('token');
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const res = await fetch(`${API_URL}/api/orders/${orderId}/repay`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                // ===================================================================
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.message || 'Failed to create repayment order.');
                }
                const { orderId: dbOrderId, razorpayOrderId, amount, currency, key } = await res.json();
                const options = {
                    key: key,
                    amount: amount,
                    currency: currency,
                    name: "Vardhan's Wear",
                    description: `Repayment for Order ID: ...${dbOrderId.substr(-6)}`,
                    order_id: razorpayOrderId,
                    handler: async function (response) {
                        await verifyPayment(response, dbOrderId);
                    },
                    prefill: { name: currentUser.name, email: currentUser.email },
                    theme: { color: "#db2777" }
                };
                const rzp = new Razorpay(options);
                rzp.on('payment.failed', function (response) {
                    console.error(response);
                    showMessage(`Payment failed: ${response.error.description}`, 'error');
                    repayButton.disabled = false;
                    repayButton.textContent = 'Repay Now';
                });
                rzp.open();
            } catch (error) {
                console.error('Error during repay:', error);
                showMessage(error.message, 'error');
                repayButton.disabled = false;
                repayButton.textContent = 'Repay Now';
            }
        }

        // Handle Order Cancel (API Path Fix)
        async function handleCancel(event, orderId) {
            event.preventDefault(); 
            event.stopPropagation(); 

            if (!confirm('Are you sure you want to cancel this pending order? This action cannot be undone.')) {
                return;
            }
            try {
                const token = localStorage.getItem('token');
                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const res = await fetch(`${API_URL}/api/orders/${orderId}/cancel`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                // ===================================================================
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.message || 'Failed to cancel order.');
                }
                showMessage('Order successfully cancelled.', 'success');
                localStorage.removeItem('vardhansCart');
                loadAndStoreOrders(); // Refresh the order list
            } catch (error) {
                console.error('Error cancelling order:', error);
                showMessage(error.message, 'error');
            }
        }

        // Verify Payment (API Path Fix)
        async function verifyPayment(paymentResponse, ourOrderId) {
            const token = localStorage.getItem('token'); 
            try {
                const verificationData = {
                    razorpay_order_id: paymentResponse.razorpay_order_id,
                    razorpay_payment_id: paymentResponse.razorpay_payment_id,
                    razorpay_signature: paymentResponse.razorpay_signature,
                    order_id: ourOrderId 
                };

                // =================== DEPLOYMENT FIX: Use API_URL ===================
                const verifyRes = await fetch(`${API_URL}/api/orders/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(verificationData)
                });
                // ===================================================================
                if (!verifyRes.ok) {
                    throw new Error('Payment verification failed.');
                }
                showMessage('Payment successful!', 'success');
                loadAndStoreOrders(); // Refresh the order list
            } catch (error) {
                console.error('Error verifying payment:', error);
                showMessage(error.message, 'error');
            }
        }

        // --- Message Box (Unchanged) ---
        function showMessage(message, type = 'success') {
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            messageText.textContent = message;
            if (type === 'error') {
                messageBox.style.borderLeftColor = '#ef4444'; // red-500
            } else if (type === 'info') {
                messageBox.style.borderLeftColor = '#3b82f6'; // blue-500
            } else {
                messageBox.style.borderLeftColor = '#10b981'; // green-500
            }
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }

        // **MODIFIED: Make all global functions accessible**
        window.openAddressModal = openAddressModal;
        window.handleDeleteAddress = handleDeleteAddress;
        window.handleRepay = handleRepay;
        window.handleCancel = handleCancel;
        window.toggleDesktopMenu = toggleDesktopMenu;
        window.logout = logout;
        window.showProfileTab = showProfileTab; 

    </script>
    <script src="//code.tidio.co/dfexxakczw7qvenssz4ma5d28igwxnrq.js" async></script>
</body>
</html>